(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"8C4M":function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"KeyboardArrowRight");t.default=r},"8HGR":function(e,t,n){"use strict";n.r(t);var a=n("hfKm"),o=n.n(a),r=n("2Eek"),i=n.n(r),l=n("XoMD"),c=n.n(l),u=n("Jo+v"),s=n.n(u),d=n("4mXO"),f=n.n(d),p=n("kOwS"),v=n("2wwy"),h=n.n(v),y=n("pLtp"),m=n.n(y),b=n("vYYK"),g=n("q1tI"),x=n.n(g),O=n("iuhU"),C=n("R/WZ"),S=n("hlFM"),j=n("LvDl"),k=n.n(j),w=n("/MKj"),T=(n("Xcx1"),n("nOHt")),N=n.n(T),M=n("PJCl"),E=n.n(M),z=n("s8cL"),L=n.n(z),I=n("iUGO"),q=n.n(I),P=n("FrwU"),R=n.n(P),D=n("hQyO"),U=n.n(D),A=n("qpA4"),_=n.n(A),H=n("dl/7"),K=n("IP2g"),V=n("wHSu"),J=x.a.createElement,W=Object(C.a)((function(e){return{panel:{width:40,backgroundImage:"linear-gradient(".concat(e.palette.primary.main,", ").concat(e.palette.primary.dark,")"),position:"absolute",left:0,top:50,height:"calc(100vh - 60px)",overflow:"auto"},btnPane:{color:"#fff",padding:"".concat(e.spacing(2),"px 0"),"& li":{height:44,display:"flex",justifyContent:"center",alignItems:"center"},"& li+li":{borderTop:"1px solid #fff"},"& li:active":{backgroundColor:H.a.A400},"& li svg":{fontSize:27}},fa:{fontSize:"24px !important"},autoMagic:{transform:"rotate(-90deg)"},toggleJStick:{}}})),X=function(e){var t=W(),n=e.history,a=e.deleteComponent,o=e.paintFlowboard,r=e.toggleJStick,i=e.openFSE;return J(S.a,{className:t.panel},J("ul",{className:t.btnPane},J("li",{title:"Back to Editor",onClick:function(){(n||N.a).push("/edit-tale/[id]","/edit-tale/current")}},J(E.a,null)),J("li",{title:"Add component"},J(q.a,null)),J("li",{title:"Select component"},J(K.a,{icon:V.c,className:t.fa})),J("li",{title:"Edit component",onClick:i},J(K.a,{icon:V.d,className:t.fa})),J("li",{title:"Save all"},J(U.a,null)),J("li",{title:"Toggle joystick",onClick:r},J(_.a,{className:t.toggleJStick})),J("li",{title:"Auto format",onClick:o},J(K.a,{icon:V.b,className:Object(O.a)(t.fa,t.autoMagic)})),J("li",{title:"Increase draw area"},J(L.a,null)),J("li",{title:"Delete selected",onClick:a},J(R.a,null))))},Y=n("CarD"),F=n.n(Y),G=n("8C4M"),Z=n.n(G),B=n("Cekx"),Q=n.n(B),$=n("AUy9"),ee=n.n($),te=x.a.createElement,ne=Object(C.a)((function(e){return{container:{position:"absolute"},btn:{position:"absolute",fontSize:30,backgroundColor:H.a[100],borderRadius:6,"&:active":{backgroundColor:H.a[300]}},left:{left:0,top:0},right:{left:60,top:0},up:{left:30,top:-30},down:{left:30,top:30}}})),ae=function(e){var t=ne(),n=e.moveLeft,a=e.moveRight,o=e.moveUp,r=e.moveDown;return te("div",{className:t.container},te(F.a,{className:Object(O.a)(t.btn,t.left),onClick:n}),te(Z.a,{className:Object(O.a)(t.btn,t.right),onClick:a}),te(Q.a,{className:Object(O.a)(t.btn,t.up),onClick:o}),te(ee.a,{className:Object(O.a)(t.btn,t.down),onClick:r}))},oe=150,re=50,ie=oe/2,le=oe/2,ce=re+3,ue=oe/2,se=re+3,de=-3,fe=50,pe=80,ve=20,he=30,ye=x.a.createElement,me=Object(C.a)((function(e){return{cg:{transform:"translate(100px, 100px)"},knot:{fill:H.a[500],strokeWidth:1,stroke:H.a[500]},selectedKnot:{strokeWidth:3,stroke:"#000"},selectedEl:{stroke:"#00f"},rect:{fill:"#fff",strokeWidth:1,stroke:e.palette.primary.main},selectedST:{"& rect":{fill:H.a[500],stroke:H.a[500]},"& text":{fill:"#fff"}},title:{fontSize:14},stid:{fontSize:14,fill:"#000"}}})),be=function(e){var t=me(),n=e.stid,a=e.title,o=e.transformStyle,r=e.start,i=e.selectedObj,l=e.handleSelection,c=e.handleMouseDown,u=e.handleMouseUp,s=e.handleMouseMove,d=function(e,t){e.stopPropagation(),l(n,t)};return ye("g",{id:n,className:t.cg,style:o,onMouseDown:function(e){return c(e,n)},onMouseUp:function(e){return u(e)},onMouseMove:function(e){return s(e)}},n===r&&ye("text",{x:"55",y:"-3",fill:"blue"},"START"),n!==r&&ye("circle",{className:Object(O.a)(t.knot,i.id===n&&"IN"===i.type&&t.selectedKnot),cx:ie,cy:-3,r:6,onClick:function(e){return d(e,"IN")}}),ye("circle",{className:Object(O.a)(t.knot,i.id===n&&"OUT"===i.type&&t.selectedKnot),cx:le,cy:ce,r:6,onClick:function(e){return d(e,"OUT")}}),ye("g",{className:Object(O.a)(i.id===n&&"ST"===i.type&&t.selectedST),onClick:function(e){return d(e,"ST")}},ye("rect",{className:t.rect,width:oe,height:re}),ye("text",{x:"5",y:"15",className:t.title},a.substr(0,20)||"Click Edit to add text"),ye("text",{x:"5",y:"30",className:t.title},a.substr(20,20)),ye("text",{x:"5",y:"45",className:t.stid},n)))},ge=x.a.createElement,xe=Object(C.a)((function(e){return{connector:{strokeWidth:4,stroke:H.a[200]},cid:{fontSize:16,fontWeight:"bold",fill:H.a[500]},selectedConnector:{"& line":{stroke:H.a[900]},"& text":{fill:"#000"}}}})),Oe=function(e){var t=xe(),n=e.c,a=e.selectedObj,o=e.handleSelection;return ge("g",{className:Object(O.a)(n.cid===a.id&&"CH"===a.type&&t.selectedConnector),onClick:function(e){e.stopPropagation(),o(n.cid,"CH")}},ge("line",{id:n.id,x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,className:t.connector}),ge("text",{className:t.cid,x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2},n.cid))},Ce=n("r9w1"),Se=n("tRbT"),je=n("Z3vd"),ke=n("gT2q"),we=x.a.createElement,Te=Object(C.a)((function(e){return{modelST:{height:70,border:"2px solid ".concat(e.palette.primary.main),padding:e.spacing(1),textAlign:"center",fontSize:14,display:"flex",flexDirection:"column",justifyContent:"center",borderRadius:4},modelCon:{height:50,display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center","& .con":{height:1,borderTop:"2px dashed ".concat(e.palette.primary.main)}},btnPanel:{display:"flex",marginTop:e.spacing(2),"& button":{flex:1},"& button+button":{marginLeft:e.spacing(2)}}}})),Ne=function(e){var t=Te(),n=e.fromStID,a=e.toStID,o=e.type,r=e.text,i=e.handleSave,l=e.handleClose,c=Object(g.useState)(""),u=c[0],s=c[1];Object(g.useEffect)((function(){return s(r)}),[r]);var d=o+" a Choice";return we(ke.a,Object(p.a)({},e,{title:d}),we(S.a,{mb:3,mt:1},we(Se.a,{container:!0},we(Se.a,{item:!0,xs:!0},we("div",{className:t.modelST},"Storylet ",n)),we(Se.a,{item:!0,xs:!0,className:t.modelCon},we("span",null,"to"),we("div",{className:"con"})),we(Se.a,{item:!0,xs:!0},we("div",{className:t.modelST},"Storylet ",a)))),we(Ce.a,{label:"Choice Text",value:u,onChange:function(e){return s(e.target.value)},variant:"outlined",fullWidth:!0}),we(S.a,{className:t.btnPanel},we(je.a,{variant:"outlined",color:"primary",onClick:l},"Cancel"),we(je.a,{variant:"contained",color:"primary",onClick:function(){return i(n,a,u,o)}},"Done")))},Me=n("9g+P"),Ee=n("dfwq"),ze=n("ttDY"),Le=n.n(ze),Ie=n("d04V"),qe=n.n(Ie),Pe=n("XXOK"),Re=n.n(Pe);function De(e,t){return function(e,t){var n=0,a=oe,o=re,r=fe,i=pe,l=he,c=ve,u={},s=h()(e).reduce((function(e,t){return e>t.length?e:t.length}),0),d=s*a+r*(s-1);for(;++n,e[n];){var f=e[n].length;if(f<s)for(var p=(d-f*a)/(f+1),v=0;v<e[n].length;v++){var y=e[n][v];u[y]={id:y},!t&&u[y].x&&u[y].y||(u[y].x=v*a+(v+1)*p+c,u[y].y=(n-1)*(o+i)+l)}else for(var m=0;m<e[n].length;m++){var b=e[n][m];u[b]={id:b},!t&&u[b].x&&u[b].y||(u[b].x=m*a+m*r+c,u[b].y=(n-1)*(o+i)+l)}}return function(e){for(var t in e)e[t].transformStyle=Ue(e[t])}(u),u}(function(e,t){var n={},a=function(e,t){var n=Object(Ee.a)(e);for(var a in t){var o=n.indexOf(t[a].next);o>-1&&n.splice(o,1)}return n}(m()(e),t),o=function a(o,r){n[r]=n[r]||[],n[r].push(o.id);var i=!0,l=!1,c=void 0;try{for(var u,s=Re()(o.choices);!(i=(u=s.next()).done);i=!0){var d=u.value,f=t[d];a(e[f.next],r+1)}}catch(p){l=!0,c=p}finally{try{i||null==s.return||s.return()}finally{if(l)throw c}}},r=!0,i=!1,l=void 0;try{for(var c,u=Re()(a);!(r=(c=u.next()).done);r=!0){var s=c.value,d=m()(n).length+1;o(e[s],d)}}catch(T){i=!0,l=T}finally{try{r||null==u.return||u.return()}finally{if(i)throw l}}var f=[],p=m()(n).sort().reverse(),v=!0,h=!1,y=void 0;try{for(var b,g=Re()(p);!(v=(b=g.next()).done);v=!0){var x=b.value;n[x]=qe()(new Le.a(n[x]));var O=!0,C=!1,S=void 0;try{for(var j,k=Re()(n[x]);!(O=(j=k.next()).done);O=!0){var w=j.value;f.indexOf(w)>-1?n[x].splice(n[x].indexOf(w),1):f.push(w)}}catch(T){C=!0,S=T}finally{try{O||null==k.return||k.return()}finally{if(C)throw S}}}}catch(T){h=!0,y=T}finally{try{v||null==g.return||g.return()}finally{if(h)throw y}}return n}(e,t),!0)}function Ue(e){return{transform:"matrix(1, 0, 0, 1, "+e.x+", "+e.y+")"}}var Ae=n("cthl"),_e=n("TxL0"),He=x.a.createElement;function Ke(e,t){var n=m()(e);if(f.a){var a=f()(e);t&&(a=a.filter((function(t){return s()(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){Object(b.a)(e,t,n[t])})):c.a?i()(e,c()(n)):Ke(Object(n)).forEach((function(t){o()(e,t,s()(n,t))}))}return e}var Je=Object(C.a)((function(e){return{outerContainer:{position:"relative",marginLeft:45,height:"calc(100vh - 100px)"},svgContainer:{border:"7px double ".concat(e.palette.primary.main),height:"100%",overflow:"auto",margin:e.spacing(1),borderRadius:e.spacing(1)},mainSVG:{height:2e3,minWidth:"100%",width:2e3,"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",userSelect:"none",borderRadius:15,"& *":{"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",userSelect:"none"}},joystick:{position:"absolute",bottom:83,left:30}}}));t.default=Object(w.b)((function(e){return{start:e.wipTale.start,storylets:e.wipTale.storylets,choices:e.wipTale.choices}}),(function(e){return{createNewTale:function(){return e(Object(Ae.b)())},deleteStorylet:function(t){return e({type:_e.i,payload:t})},deleteChoice:function(t){return e({type:_e.c,payload:t})},createNewChoice:function(t,n,a){return e(Object(Ae.a)(t,n,a))},updateChoiceText:function(t,n){return e(Object(Ae.e)(t,n))}}}))((function(e){var t=Je(),n=e.storylets,a=e.choices,o=e.start,r=e.history,i=e.createNewTale,l=e.deleteStorylet,c=e.deleteChoice,u=e.createNewChoice,s=e.updateChoiceText,d=Object(g.useState)({}),f=d[0],v=d[1],y=Object(g.useState)({}),x=y[0],C=y[1],j=Object(g.useState)(!1),w=j[0],T=j[1],N=Object(g.useState)(""),M=N[0],E=N[1],z=Object(g.useState)({x:0,y:0}),L=z[0],I=z[1],q=Object(g.useState)({id:"",type:""}),P=q[0],R=q[1],D=Object(g.useState)({}),U=D[0],A=D[1],_=Object(g.useState)({}),H=_[0],K=_[1],V=Object(g.useCallback)((function(){var e=De(n,a),t=function(e,t,n){var a={},o=ue,r=se,i=de;for(var l in e){var c=e[l],u=!0,s=!1,d=void 0;try{for(var f,p=Re()(c.choices);!(u=(f=p.next()).done);u=!0){var v=f.value,h=t[v],y=n[c.id].x+o,m=n[c.id].y+r,b=n[h.next].x+o,g=n[h.next].y+i,x=c.id+"---"+h.next;a[x]={id:x,cid:v,x1:y,y1:m,x2:b,y2:g}}}catch(O){s=!0,d=O}finally{try{u||null==p.return||p.return()}finally{if(s)throw d}}}return a}(n,a,e);v(e),C(t)}),[n,a]);Object(g.useEffect)((function(){o||i(),V()}),[i,o,V]);var J=function(e,t){if("OUT"===P.type&&"IN"===t){var n=P.id,o=n+"---"+e;A({isOpen:!0,fromStID:n,toStID:e,type:x[o]?"Edit":"Create",text:x[o]?a[x[o].cid].text:""})}R({id:e,type:t})},W=function(e,t){e.stopPropagation(),E(t),I({x:e.pageX,y:e.pageY})},Y=function(e){e.stopPropagation(),E(""),I({x:0,y:0})},F=function(e,t,n){if(e&&f[e]){var a={id:e,x:f[e].x+t,y:f[e].y+n};a.transformStyle=Ue(a);var o=Ve({},f,Object(b.a)({},e,a));v(o),function(e){var t=Ve({},x),n=ue,a=se,o=de;for(var r in t){var i=t[r],l=i.id.split("---"),c=l[0],u=l[1];e.id===c?((i=Ve({},i)).x1=e.x+n,i.y1=e.y+a,t=Ve({},t,Object(b.a)({},i.id,i))):e.id===u&&((i=Ve({},i)).x2=e.x+n,i.y2=e.y+o,t=Ve({},t,Object(b.a)({},i.id,i)))}C(t)}(a)}},G=k.a.throttle((function(e){if(M){var t=e.pageX-L.x,n=e.pageY-L.y;F(M,t,n),I({x:e.pageX,y:e.pageY})}}),1e3),Z=function(e,t){"ST"===P.type&&F(P.id,e,t)};return m()(n).length!==m()(f).length||m()(a).length!==m()(x).length?He(S.a,null,"Updating ..."):He(S.a,null,He(X,{history:r,deleteComponent:function(){if(P.id&&"IN"!==P.type&&"OUT"!==P.type)if(P.id===o)alert("Start storylet can not be deleted. Please edit it to your choice.");else{var e="";"S"===P.id[0]?e="STORYLET":"C"===P.id[0]&&(e="CHOICE"),window.confirm("Are you sure you want to delete ".concat(e," ").concat(P.id,". Once deleted, it may not be recovered back."))&&("STORYLET"===e?l(P.id):"CHOICE"===e&&c(P.id))}else alert("Select a storylet or choice (connector) first. Then click on delete.")},paintFlowboard:V,toggleJStick:function(){return T(!w)},openFSE:function(){var e;P.id&&"IN"!==P.type&&"OUT"!==P.type?("S"===P.id[0]?e=n[P.id]:"C"===P.id[0]&&(e=a[P.id]),K({component:e,isVisible:!0})):alert("Select a storylet or choice (connector) first. Then click on delete.")}}),He("div",{className:t.outerContainer},He("div",{className:t.svgContainer,onClick:function(){return R({})}},He("svg",{className:t.mainSVG,onMouseUp:function(e){return Y(e)}},h()(x).map((function(e){return He(Oe,{c:e,key:e.id,selectedObj:P,handleSelection:J})})),h()(f).map((function(e){var t=n[e.id];return He(be,{stid:t.id,title:t.title,transformStyle:e.transformStyle,start:o,key:t.id,selectedObj:P,handleSelection:J,handleMouseDown:W,handleMouseUp:Y,handleMouseMove:G})})))),He("div",{className:Object(O.a)(t.joystick,!w&&"hide")},He(ae,{moveLeft:function(){return Z(-10,0)},moveRight:function(){return Z(10,0)},moveUp:function(){return Z(0,-10)},moveDown:function(){return Z(0,10)}}))),He(Ne,Object(p.a)({isOpen:U.isOpen},U,{handleClose:function(){return A({})},handleSave:function(e,t,n,a){if("Create"===a)u(e,t,n);else if("Edit"===a){var o=x[e+"---"+t].cid;s(o,n)}else console.log("Could not understand the type in saveEditCreateChoice");A({})}})),He(Me.a,{isOpen:H.isVisible,handleClose:function(){return K({})},component:H.component}))}))},AUy9:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"}),"KeyboardArrowDown");t.default=r},CarD:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}),"KeyboardArrowLeft");t.default=r},Cekx:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp");t.default=r},PJCl:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");t.default=r},hQyO:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save");t.default=r},qpA4:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"}),"OpenWith");t.default=r},s8cL:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M15 3l2.3 2.3-2.89 2.87 1.42 1.42L18.7 6.7 21 9V3h-6zM3 9l2.3-2.3 2.87 2.89 1.42-1.42L6.7 5.3 9 3H3v6zm6 12l-2.3-2.3 2.89-2.87-1.42-1.42L5.3 17.3 3 15v6h6zm12-6l-2.3 2.3-2.87-2.89-1.42 1.42 2.89 2.87L15 21h6v-6z"}),"ZoomOutMap");t.default=r}}]);