{"version":3,"file":"static/webpack/static\\development\\pages\\create-tale.js.0eea83929631fe21e24b.hot-update.js","sources":["webpack:///./components/page-modules/createTale/CreateTaleFinish.js"],"sourcesContent":["import React, { useState } from 'react'\r\n// import Container from '@material-ui/core/Container'\r\nimport Box from '@material-ui/core/Box'\r\nimport Grid from '@material-ui/core/Grid'\r\n// import Paper from '@material-ui/core/Paper'\r\n// import Typography from '@material-ui/core/Typography'\r\nimport Button from '@material-ui/core/Button'\r\nimport { connect } from 'react-redux'\r\nimport ExportTaleModal from './ExportTaleModal'\r\nimport { URL_CREATE_TALE } from '../../../utils/urls'\r\nimport { InfoCard } from '../../common/cards'\r\n\r\nfunction download (filename, text) {\r\n    var element = document.createElement('a');\r\n    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\r\n    element.setAttribute('download', filename);\r\n\r\n    element.style.display = 'none';\r\n    document.body.appendChild(element);\r\n\r\n    element.click();\r\n\r\n    document.body.removeChild(element);\r\n}\r\n\r\nconst CreateTaleFinish = props => {\r\n    const { wipTale } = props\r\n    const [isExpTaleModalVisible, setExpTModalVis] = useState(false)\r\n    const [expTale, setExpTale] = useState('')\r\n    const getWIPTale = () => {\r\n        const { storyboard, ...tale } = wipTale\r\n        return tale\r\n    }\r\n\r\n    const exportWIPTale = () => {\r\n        const tale = getWIPTale()\r\n        console.log(tale)\r\n        const content = btoa(encodeURIComponent((JSON.stringify(tale))))\r\n        download(`${tale.info.name}_${tale.id}.txt`, content)\r\n        setExpTale(content)\r\n        setExpTModalVis(true)\r\n    }\r\n\r\n    const saveTaleLocal = () => {\r\n        const tale = getWIPTale()\r\n        if (typeof(window) !== 'undefined') {\r\n            const allReactales = JSON.parse(window.localStorage.getItem(\"allReactales\")) || {}\r\n            allReactales[tale.id] = tale\r\n            window.localStorage.setItem(\"allReactales\", JSON.stringify(allReactales))\r\n            alert(\"Saved succesfully. \" + localStorageSpace())\r\n        }\r\n        else {\r\n            console.log(\"Failed in saveTaleLocal. window is not available. Probably this is not a browser... Need Fix here...\")\r\n        }\r\n        \r\n    }\r\n\r\n    const saveTaleOnline = () => {\r\n        const tale = getWIPTale()\r\n        // console.log(tale)\r\n        fetch(URL_CREATE_TALE,\r\n        {\r\n            method: \"POST\",\r\n            body: JSON.stringify(tale)\r\n        })\r\n        .then(res => res.json())\r\n        .then(res => console.log(res))\r\n    }\r\n\r\n    const localStorageSpace = () => {\r\n        var allStrings = '';\r\n        if(typeof(window) === 'undefined') return\r\n        for (var key in window.localStorage) {\r\n            if (window.localStorage.hasOwnProperty(key)) {\r\n                allStrings += window.localStorage[key];\r\n            }\r\n        }\r\n        return allStrings ? 3 + ((allStrings.length * 16) / (8 * 1024)) + ' KB' : 'Empty (0 KB)';\r\n    };\r\n\r\n    return (\r\n        <Box py={1}>\r\n            <ExportTaleModal \r\n                isOpen = {isExpTaleModalVisible}\r\n                handleClose = {() => setExpTModalVis(false)}\r\n                expTaleContent = {expTale}\r\n            />\r\n\r\n            <Grid container spacing={1}>\r\n                <Grid item xs={12} md={4}>\r\n                    <InfoCard />\r\n                </Grid>\r\n                <Grid item xs={12} md={4}>\r\n                    <InfoCard />\r\n                </Grid>\r\n                <Grid item xs={12} md={4}>\r\n                    <InfoCard />\r\n                </Grid>\r\n            </Grid>\r\n\r\n\r\n            \r\n\r\n\r\n            <Button\r\n                variant=\"contained\"\r\n                color=\"primary\"\r\n                className=\"margin-right-15 margin-top-15\"\r\n                onClick={exportWIPTale}\r\n            >\r\n                Export this Reactale\r\n            </Button>\r\n            <Button\r\n                variant=\"contained\"\r\n                color=\"primary\"\r\n                className=\"margin-right-15 margin-top-15\"\r\n                onClick={saveTaleLocal}\r\n            >\r\n                Save in local\r\n            </Button>\r\n            <Button\r\n                variant=\"contained\"\r\n                color=\"primary\"\r\n                className=\"margin-top-15\"\r\n                onClick={saveTaleOnline}\r\n            >\r\n                Save Online\r\n            </Button>\r\n        </Box>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n    wipTale: state.wipTale\r\n})\r\n\r\nexport default connect(mapStateToProps)(CreateTaleFinish)"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA,aAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAFA;AAIA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;AAAA;AACA;AADA;AAAA;AACA;AAGA;;;;A","sourceRoot":""}