{"version":3,"file":"static/webpack/static\\development\\pages\\edit-tale\\[id].js.a2fedbef0f2982bddb73.hot-update.js","sources":["webpack:///./components/page-modules/createTale/CreateTale.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react'\r\nimport NextRouter, { useRouter } from 'next/router'\r\n// import { makeStyles } from '@material-ui/core/styles'\r\nimport Paper from '@material-ui/core/Paper'\r\nimport Tabs from '@material-ui/core/Tabs'\r\nimport Tab from '@material-ui/core/Tab'\r\nimport Box from '@material-ui/core/Box'\r\nimport Button from '@material-ui/core/Button'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport AccountTreeIcon from '@material-ui/icons/AccountTree'\r\nimport ImportTaleModal from './ImportTaleModal'\r\nimport CreateTaleIntro from './CreateTaleIntro'\r\nimport CreateTaleBody from './CreateTaleBody'\r\nimport CreateTaleFinish from './CreateTaleFinish'\r\nimport { startsWith } from '../../../utils/util'\r\nimport { connect } from 'react-redux'\r\nimport {\r\n    actionCreateNewTale,\r\n    actionSaveTaleAndReset,\r\n    actionSetTaleAsWIP\r\n} from '../../../redux/actionCreators/createTaleActions'\r\n\r\nimport { GET_APP_VER } from \"../../../utils/urls\";\r\n\r\nconst CreateTale = props => {\r\n    const routeHook = useRouter()\r\n    // console.log('routeHook = ', routeHook)\r\n    const [visibleTabIndex, setVisibleTab] = useState(0)\r\n    const [pageTitle, setPageTitle] = useState(\"Create\")\r\n    const [isImportModalOpen, setIsImportModalOpen] = useState(false)\r\n    const { id, createNewTale, saveAndResetAll, match, setTaleAsWIP, history } = props\r\n    \r\n    const handleTabSwitch = (event, newValue) => {\r\n        setVisibleTab(newValue)\r\n    }\r\n\r\n    const goTo = url => NextRouter ? NextRouter.push(url) : history.push(url)\r\n\r\n    const setReactaleForEditing = useCallback(() => {\r\n        let storyID = routeHook ? routeHook.query.id : match.params.id\r\n        // console.log(storyID)\r\n\r\n        // If it is a local story\r\n        // Then the ID should start with \"local\"\r\n        if (storyID.indexOf(\"local\") >= 0) {\r\n            storyID = storyID.trim().replace(\"local-\", \"\")\r\n            \r\n            // FOR SSR\r\n            if (typeof(window) !== 'undefined') {\r\n                const allReactales = JSON.parse(window.localStorage.getItem(\"allReactales\")) || {}\r\n                const theTale = allReactales[storyID]\r\n                setTaleAsWIP(theTale)\r\n            }\r\n            else {\r\n                console.log(\"Failed in setReactaleForEditing inside CreateTale. window is not available. Probably this is not a browser... Need Fix here...\")\r\n            }\r\n        }\r\n    }, [match, setTaleAsWIP, routeHook])\r\n\r\n    const setImportedTaleForEditing = tale => {\r\n        setTaleAsWIP(tale)\r\n        setIsImportModalOpen(false)\r\n    }\r\n\r\n    useEffect(() => {\r\n        // if already an ID is present,\r\n        // then already a story is in progress of create / edit\r\n        let path = routeHook ? routeHook.pathname : match.url\r\n\r\n        if (path === '/create-tale' && !id) {\r\n            createNewTale()\r\n        }\r\n        // edting current in progress tale\r\n        // coming back from FLowTale\r\n        else if(startsWith(path, '/edit-tale/current')) {\r\n            // Do nothing\r\n            console.log('back from TalesFlow')\r\n        }\r\n        // else Edit Reactale\r\n        else if (startsWith(path, '/edit-tale/')) {\r\n            setPageTitle(\"Edit\")\r\n            setReactaleForEditing()\r\n        }\r\n        // Already something in progress\r\n        // Do nothing\r\n        else {\r\n            console.log('inside create-edit... else case...')\r\n        }\r\n\r\n        return (() => {\r\n            console.log(\"Leaving Story Create Page... Now is a good time to save changes so far...\")\r\n            //saveAndResetAll()\r\n        })\r\n    }, [id, createNewTale, saveAndResetAll, match, setReactaleForEditing])\r\n\r\n    return (\r\n        <Box p={2}>\r\n            \r\n            <Typography variant=\"h4\" component=\"h1\">\r\n                {pageTitle} Reactale\r\n            </Typography>\r\n            \r\n            <Box mt={2} mb={4} className=\"flex-space-between\">\r\n                <Typography variant=\"subtitle1\">\r\n                    {pageTitle} a Reactale or import one to edit it.\r\n                </Typography>\r\n                \r\n                <Box>\r\n                    <Button \r\n                        variant=\"contained\" \r\n                        color=\"primary\"\r\n                        className=\"margin-right-15 margin-top-15\"\r\n                        onClick={() => setIsImportModalOpen(true)}\r\n                    >\r\n                        Import Reactale\r\n                    </Button>\r\n                    <Button \r\n                        variant=\"contained\" \r\n                        color=\"primary\"\r\n                        className=\"margin-top-15\"\r\n                        startIcon={<span className=\"talesflowicon\"><AccountTreeIcon /></span>}\r\n                        onClick={() => goTo('/tales-flow')}\r\n                    >\r\n                        TalesFlow\r\n                    </Button>\r\n                </Box>\r\n                \r\n            </Box>\r\n\r\n            <Paper square>\r\n                <Tabs\r\n                    value={visibleTabIndex}\r\n                    indicatorColor=\"primary\"\r\n                    textColor=\"primary\"\r\n                    onChange={handleTabSwitch}\r\n                    centered\r\n                    aria-label=\"tabs to create the story\"\r\n                >\r\n                    <Tab label=\"Intro\" />\r\n                    <Tab label=\"Body\" />\r\n                    <Tab label=\"Finish\" />\r\n                </Tabs>\r\n            </Paper>\r\n            \r\n            <Box className={visibleTabIndex !== 0 ? 'hide' : ''}>\r\n                <CreateTaleIntro />\r\n            </Box>\r\n\r\n            <Box className={visibleTabIndex !== 1 ? 'hide' : ''}>\r\n                <CreateTaleBody />\r\n            </Box>\r\n\r\n            <Box className={visibleTabIndex !== 2 ? 'hide' : ''}>\r\n                <CreateTaleFinish />\r\n            </Box>\r\n\r\n            {/* Import Tale Modal */}\r\n            <ImportTaleModal \r\n                isOpen={isImportModalOpen} \r\n                handleClose = {() => setIsImportModalOpen(false)}\r\n                setForEditing = {setImportedTaleForEditing}\r\n            />\r\n        </Box>\r\n    )\r\n}\r\nconst mapStateToProps = state => ({\r\n    id: state.wipTale.id\r\n})\r\nconst mapDispatchToProps = dispatch => ({\r\n    createNewTale: () => dispatch(actionCreateNewTale()),\r\n    saveAndResetAll: () => dispatch(actionSaveTaleAndReset()),\r\n    setTaleAsWIP: (tale) => dispatch(actionSetTaleAsWIP(tale))\r\n})\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CreateTale)"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AAFA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAOA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA,eAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAJA;AAMA;AACA;AACA;AAHA;AAMA;AACA;AACA;AAEA;AALA;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AAAA;AAAA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAHA;AAAA;AACA;AAIA;;;;A","sourceRoot":""}