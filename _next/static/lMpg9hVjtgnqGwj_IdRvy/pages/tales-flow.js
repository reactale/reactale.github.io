(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"2wwy":function(e,t,n){e.exports=n("nhzr")},"8C4M":function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"KeyboardArrowRight");t.default=r},AUy9:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"}),"KeyboardArrowDown");t.default=r},CarD:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}),"KeyboardArrowLeft");t.default=r},Cekx:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp");t.default=r},E8gZ:function(e,t,n){var a=n("jmDH"),o=n("w6GO"),r=n("NsO/"),i=n("NV0k").f;e.exports=function(e){return function(t){for(var n,l=r(t),c=o(l),u=c.length,s=0,d=[];u>s;)n=c[s++],a&&!i.call(l,n)||d.push(e?[n,l[n]]:l[n]);return d}}},PJCl:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");t.default=r},cSug:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tales-flow",function(){return n("jsgN")}])},fW1p:function(e,t,n){var a=n("Y7ZC"),o=n("E8gZ")(!1);a(a.S,"Object",{values:function(e){return o(e)}})},hQyO:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save");t.default=r},jsgN:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),o=n.n(a),r=n("okHz"),i=(n("a6RD"),n("hfKm")),l=n.n(i),c=n("2Eek"),u=n.n(c),s=n("XoMD"),d=n.n(s),f=n("Jo+v"),p=n.n(f),v=n("4mXO"),h=n.n(v),y=n("kOwS"),m=n("2wwy"),b=n.n(m),g=n("pLtp"),x=n.n(g),O=n("vYYK"),C=n("iuhU"),S=n("R/WZ"),j=n("hlFM"),k=n("LvDl"),w=n.n(k),N=n("/MKj"),T=(n("Xcx1"),n("nOHt")),E=n.n(T),M=n("PJCl"),z=n.n(M),L=n("s8cL"),I=n.n(L),P=n("iUGO"),_=n.n(P),q=n("FrwU"),D=n.n(q),R=n("hQyO"),U=n.n(R),A=n("qpA4"),H=n.n(A),W=n("dl/7"),K=n("IP2g"),V=n("wHSu"),X=o.a.createElement,J=Object(S.a)((function(e){return{panel:{width:40,backgroundImage:"linear-gradient(".concat(e.palette.primary.main,", ").concat(e.palette.primary.dark,")"),position:"absolute",left:0,top:50,height:"calc(100vh - 60px)",overflow:"auto"},btnPane:{color:"#fff",padding:"".concat(e.spacing(2),"px 0"),"& li":{height:44,display:"flex",justifyContent:"center",alignItems:"center"},"& li+li":{borderTop:"1px solid #fff"},"& li:active":{backgroundColor:W.a.A400},"& li svg":{fontSize:27}},fa:{fontSize:"24px !important",width:25,height:25},autoMagic:{transform:"rotate(-90deg)"},toggleJStick:{}}})),Y=function(e){var t=J(),n=e.history,a=e.deleteComponent,o=e.paintFlowboard,r=e.toggleJStick,i=e.openFSE;return X(j.a,{className:t.panel},X("ul",{className:t.btnPane},X("li",{title:"Back to Editor",onClick:function(){(n||E.a).push("/edit-tale/[id]","/edit-tale/current")}},X(z.a,null)),X("li",{title:"Add component"},X(_.a,null)),X("li",{title:"Select component"},X(K.a,{icon:V.c,className:t.fa})),X("li",{title:"Edit component",onClick:i},X(K.a,{icon:V.d,className:t.fa})),X("li",{title:"Save all"},X(U.a,null)),X("li",{title:"Toggle joystick",onClick:r},X(H.a,{className:t.toggleJStick})),X("li",{title:"Auto format",onClick:o},X(K.a,{icon:V.b,className:Object(C.a)(t.fa,t.autoMagic)})),X("li",{title:"Increase draw area"},X(I.a,null)),X("li",{title:"Delete selected",onClick:a},X(D.a,null))))},F=n("CarD"),Z=n.n(F),G=n("8C4M"),B=n.n(G),Q=n("Cekx"),$=n.n(Q),ee=n("AUy9"),te=n.n(ee),ne=o.a.createElement,ae=Object(S.a)((function(e){return{container:{position:"absolute"},btn:{position:"absolute",fontSize:30,backgroundColor:W.a[100],borderRadius:6,"&:active":{backgroundColor:W.a[300]}},left:{left:0,top:0},right:{left:60,top:0},up:{left:30,top:-30},down:{left:30,top:30}}})),oe=function(e){var t=ae(),n=e.moveLeft,a=e.moveRight,o=e.moveUp,r=e.moveDown;return ne("div",{className:t.container},ne(Z.a,{className:Object(C.a)(t.btn,t.left),onClick:n}),ne(B.a,{className:Object(C.a)(t.btn,t.right),onClick:a}),ne($.a,{className:Object(C.a)(t.btn,t.up),onClick:o}),ne(te.a,{className:Object(C.a)(t.btn,t.down),onClick:r}))},re=150,ie=50,le=re/2,ce=re/2,ue=ie+3,se=re/2,de=ie+3,fe=-3,pe=50,ve=80,he=20,ye=30,me=o.a.createElement,be=Object(S.a)((function(e){return{cg:{transform:"translate(100px, 100px)"},knot:{fill:W.a[500],strokeWidth:1,stroke:W.a[500]},selectedKnot:{strokeWidth:3,stroke:"#000"},selectedEl:{stroke:"#00f"},rect:{fill:"#fff",strokeWidth:1,stroke:e.palette.primary.main},selectedST:{"& rect":{fill:W.a[500],stroke:W.a[500]},"& text":{fill:"#fff"}},title:{fontSize:14},stid:{fontSize:14,fill:"#000"}}})),ge=function(e){var t=be(),n=e.stid,a=e.title,o=e.transformStyle,r=e.start,i=e.selectedObj,l=e.handleSelection,c=e.handleMouseDown,u=e.handleMouseUp,s=e.handleMouseMove,d=function(e,t){e.stopPropagation(),l(n,t)};return me("g",{id:n,className:t.cg,style:o,onMouseDown:function(e){return c(e,n)},onMouseUp:function(e){return u(e)},onMouseMove:function(e){return s(e)}},n===r&&me("text",{x:"55",y:"-3",fill:"blue"},"START"),n!==r&&me("circle",{className:Object(C.a)(t.knot,i.id===n&&"IN"===i.type&&t.selectedKnot),cx:le,cy:-3,r:6,onClick:function(e){return d(e,"IN")}}),me("circle",{className:Object(C.a)(t.knot,i.id===n&&"OUT"===i.type&&t.selectedKnot),cx:ce,cy:ue,r:6,onClick:function(e){return d(e,"OUT")}}),me("g",{className:Object(C.a)(i.id===n&&"ST"===i.type&&t.selectedST),onClick:function(e){return d(e,"ST")}},me("rect",{className:t.rect,width:re,height:ie}),me("text",{x:"5",y:"15",className:t.title},a.substr(0,20)||"Click Edit to add text"),me("text",{x:"5",y:"30",className:t.title},a.substr(20,20)),me("text",{x:"5",y:"45",className:t.stid},n)))},xe=o.a.createElement,Oe=Object(S.a)((function(e){return{connector:{strokeWidth:4,stroke:W.a[200]},cid:{fontSize:16,fontWeight:"bold",fill:W.a[500]},selectedConnector:{"& line":{stroke:W.a[900]},"& text":{fill:"#000"}}}})),Ce=function(e){var t=Oe(),n=e.c,a=e.selectedObj,o=e.handleSelection;return xe("g",{className:Object(C.a)(n.cid===a.id&&"CH"===a.type&&t.selectedConnector),onClick:function(e){e.stopPropagation(),o(n.cid,"CH")}},xe("line",{id:n.id,x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,className:t.connector}),xe("text",{className:t.cid,x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2},n.cid))},Se=n("r9w1"),je=n("tRbT"),ke=n("Z3vd"),we=n("gT2q"),Ne=o.a.createElement,Te=Object(S.a)((function(e){return{modelST:{height:70,border:"2px solid ".concat(e.palette.primary.main),padding:e.spacing(1),textAlign:"center",fontSize:14,display:"flex",flexDirection:"column",justifyContent:"center",borderRadius:4},modelCon:{height:50,display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center","& .con":{height:1,borderTop:"2px dashed ".concat(e.palette.primary.main)}},btnPanel:{display:"flex",marginTop:e.spacing(2),"& button":{flex:1},"& button+button":{marginLeft:e.spacing(2)}}}})),Ee=function(e){var t=Te(),n=e.fromStID,o=e.toStID,r=e.type,i=e.text,l=e.handleSave,c=e.handleClose,u=Object(a.useState)(""),s=u[0],d=u[1];Object(a.useEffect)((function(){return d(i)}),[i]);var f=r+" a Choice";return Ne(we.a,Object(y.a)({},e,{title:f}),Ne(j.a,{mb:3,mt:1},Ne(je.a,{container:!0},Ne(je.a,{item:!0,xs:!0},Ne("div",{className:t.modelST},"Storylet ",n)),Ne(je.a,{item:!0,xs:!0,className:t.modelCon},Ne("span",null,"to"),Ne("div",{className:"con"})),Ne(je.a,{item:!0,xs:!0},Ne("div",{className:t.modelST},"Storylet ",o)))),Ne(Se.a,{label:"Choice Text",value:s,onChange:function(e){return d(e.target.value)},variant:"outlined",fullWidth:!0}),Ne(j.a,{className:t.btnPanel},Ne(ke.a,{variant:"outlined",color:"primary",onClick:c},"Cancel"),Ne(ke.a,{variant:"contained",color:"primary",onClick:function(){return l(n,o,s,r)}},"Done")))},Me=n("9g+P"),ze=n("dfwq"),Le=n("ttDY"),Ie=n.n(Le),Pe=n("d04V"),_e=n.n(Pe),qe=n("XXOK"),De=n.n(qe);function Re(e,t){return function(e,t){var n=0,a=re,o=ie,r=pe,i=ve,l=ye,c=he,u={},s=b()(e).reduce((function(e,t){return e>t.length?e:t.length}),0),d=s*a+r*(s-1);for(;++n,e[n];){var f=e[n].length;if(f<s)for(var p=(d-f*a)/(f+1),v=0;v<e[n].length;v++){var h=e[n][v];u[h]={id:h},!t&&u[h].x&&u[h].y||(u[h].x=v*a+(v+1)*p+c,u[h].y=(n-1)*(o+i)+l)}else for(var y=0;y<e[n].length;y++){var m=e[n][y];u[m]={id:m},!t&&u[m].x&&u[m].y||(u[m].x=y*a+y*r+c,u[m].y=(n-1)*(o+i)+l)}}return function(e){for(var t in e)e[t].transformStyle=Ue(e[t])}(u),u}(function(e,t){var n={},a=function(e,t){var n=Object(ze.a)(e);for(var a in t){var o=n.indexOf(t[a].next);o>-1&&n.splice(o,1)}return n}(x()(e),t),o=function a(o,r){n[r]=n[r]||[],n[r].push(o.id);var i=!0,l=!1,c=void 0;try{for(var u,s=De()(o.choices);!(i=(u=s.next()).done);i=!0){var d=u.value,f=t[d];a(e[f.next],r+1)}}catch(p){l=!0,c=p}finally{try{i||null==s.return||s.return()}finally{if(l)throw c}}},r=!0,i=!1,l=void 0;try{for(var c,u=De()(a);!(r=(c=u.next()).done);r=!0){var s=c.value,d=x()(n).length+1;o(e[s],d)}}catch(N){i=!0,l=N}finally{try{r||null==u.return||u.return()}finally{if(i)throw l}}var f=[],p=x()(n).sort().reverse(),v=!0,h=!1,y=void 0;try{for(var m,b=De()(p);!(v=(m=b.next()).done);v=!0){var g=m.value;n[g]=_e()(new Ie.a(n[g]));var O=!0,C=!1,S=void 0;try{for(var j,k=De()(n[g]);!(O=(j=k.next()).done);O=!0){var w=j.value;f.indexOf(w)>-1?n[g].splice(n[g].indexOf(w),1):f.push(w)}}catch(N){C=!0,S=N}finally{try{O||null==k.return||k.return()}finally{if(C)throw S}}}}catch(N){h=!0,y=N}finally{try{v||null==b.return||b.return()}finally{if(h)throw y}}return n}(e,t),!0)}function Ue(e){return{transform:"matrix(1, 0, 0, 1, "+e.x+", "+e.y+")"}}var Ae=n("cthl"),He=n("TxL0"),We=o.a.createElement;function Ke(e,t){var n=x()(e);if(h.a){var a=h()(e);t&&(a=a.filter((function(t){return p()(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){Object(O.a)(e,t,n[t])})):d.a?u()(e,d()(n)):Ke(Object(n)).forEach((function(t){l()(e,t,p()(n,t))}))}return e}var Xe=Object(S.a)((function(e){return{outerContainer:{position:"relative",marginLeft:35,height:"calc(100vh - 100px)"},svgContainer:{border:"7px double ".concat(e.palette.primary.main),height:"100%",overflow:"auto",margin:"".concat(e.spacing(1),"px 0"),borderRadius:e.spacing(1)},mainSVG:{height:2e3,minWidth:"100%",width:2e3,"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",userSelect:"none",borderRadius:15,"& *":{"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",userSelect:"none"}},joystick:{position:"absolute",bottom:83,left:30}}})),Je=Object(N.b)((function(e){return{start:e.wipTale.start,storylets:e.wipTale.storylets,choices:e.wipTale.choices}}),(function(e){return{createNewTale:function(){return e(Object(Ae.b)())},deleteStorylet:function(t){return e({type:He.i,payload:t})},deleteChoice:function(t){return e({type:He.c,payload:t})},createNewChoice:function(t,n,a){return e(Object(Ae.a)(t,n,a))},updateChoiceText:function(t,n){return e(Object(Ae.e)(t,n))}}}))((function(e){var t=Xe(),n=e.storylets,o=e.choices,r=e.start,i=e.history,l=e.createNewTale,c=e.deleteStorylet,u=e.deleteChoice,s=e.createNewChoice,d=e.updateChoiceText,f=Object(a.useState)({}),p=f[0],v=f[1],h=Object(a.useState)({}),m=h[0],g=h[1],S=Object(a.useState)(!1),k=S[0],N=S[1],T=Object(a.useState)(""),E=T[0],M=T[1],z=Object(a.useState)({x:0,y:0}),L=z[0],I=z[1],P=Object(a.useState)({id:"",type:""}),_=P[0],q=P[1],D=Object(a.useState)({}),R=D[0],U=D[1],A=Object(a.useState)({}),H=A[0],W=A[1],K=Object(a.useCallback)((function(){var e=Re(n,o),t=function(e,t,n){var a={},o=se,r=de,i=fe;for(var l in e){var c=e[l],u=!0,s=!1,d=void 0;try{for(var f,p=De()(c.choices);!(u=(f=p.next()).done);u=!0){var v=f.value,h=t[v],y=n[c.id].x+o,m=n[c.id].y+r,b=n[h.next].x+o,g=n[h.next].y+i,x=c.id+"---"+h.next;a[x]={id:x,cid:v,x1:y,y1:m,x2:b,y2:g}}}catch(O){s=!0,d=O}finally{try{u||null==p.return||p.return()}finally{if(s)throw d}}}return a}(n,o,e);v(e),g(t)}),[n,o]);Object(a.useEffect)((function(){r||l(),K()}),[l,r,K]);var V=function(e,t){if("OUT"===_.type&&"IN"===t){var n=_.id,a=n+"---"+e;U({isOpen:!0,fromStID:n,toStID:e,type:m[a]?"Edit":"Create",text:m[a]?o[m[a].cid].text:""})}q({id:e,type:t})},X=function(e,t){e.stopPropagation(),M(t),I({x:e.pageX,y:e.pageY})},J=function(e){e.stopPropagation(),M(""),I({x:0,y:0})},F=function(e,t,n){if(e&&p[e]){var a={id:e,x:p[e].x+t,y:p[e].y+n};a.transformStyle=Ue(a);var o=Ve({},p,Object(O.a)({},e,a));v(o),function(e){var t=Ve({},m),n=se,a=de,o=fe;for(var r in t){var i=t[r],l=i.id.split("---"),c=l[0],u=l[1];e.id===c?((i=Ve({},i)).x1=e.x+n,i.y1=e.y+a,t=Ve({},t,Object(O.a)({},i.id,i))):e.id===u&&((i=Ve({},i)).x2=e.x+n,i.y2=e.y+o,t=Ve({},t,Object(O.a)({},i.id,i)))}g(t)}(a)}},Z=w.a.throttle((function(e){if(E){var t=e.pageX-L.x,n=e.pageY-L.y;F(E,t,n),I({x:e.pageX,y:e.pageY})}}),1e3),G=function(e,t){"ST"===_.type&&F(_.id,e,t)};return x()(n).length!==x()(p).length||x()(o).length!==x()(m).length?We(j.a,null,"Updating ..."):We(j.a,null,We(Y,{history:i,deleteComponent:function(){if(_.id&&"IN"!==_.type&&"OUT"!==_.type)if(_.id===r)alert("Start storylet can not be deleted. Please edit it to your choice.");else{var e="";"S"===_.id[0]?e="STORYLET":"C"===_.id[0]&&(e="CHOICE"),window.confirm("Are you sure you want to delete ".concat(e," ").concat(_.id,". Once deleted, it may not be recovered back."))&&("STORYLET"===e?c(_.id):"CHOICE"===e&&u(_.id))}else alert("Select a storylet or choice (connector) first. Then click on delete.")},paintFlowboard:K,toggleJStick:function(){return N(!k)},openFSE:function(){var e;_.id&&"IN"!==_.type&&"OUT"!==_.type?("S"===_.id[0]?e=n[_.id]:"C"===_.id[0]&&(e=o[_.id]),W({component:e,isVisible:!0})):alert("Select a storylet or choice (connector) first. Then click on delete.")}}),We("div",{className:t.outerContainer},We("div",{className:t.svgContainer,onClick:function(){return q({})}},We("svg",{className:t.mainSVG,onMouseUp:function(e){return J(e)}},b()(m).map((function(e){return We(Ce,{c:e,key:e.id,selectedObj:_,handleSelection:V})})),b()(p).map((function(e){var t=n[e.id];return We(ge,{stid:t.id,title:t.title,transformStyle:e.transformStyle,start:r,key:t.id,selectedObj:_,handleSelection:V,handleMouseDown:X,handleMouseUp:J,handleMouseMove:Z})})))),We("div",{className:Object(C.a)(t.joystick,!k&&"hide")},We(oe,{moveLeft:function(){return G(-10,0)},moveRight:function(){return G(10,0)},moveUp:function(){return G(0,-10)},moveDown:function(){return G(0,10)}}))),We(Ee,Object(y.a)({isOpen:R.isOpen},R,{handleClose:function(){return U({})},handleSave:function(e,t,n,a){if("Create"===a)s(e,t,n);else if("Edit"===a){var o=m[e+"---"+t].cid;d(o,n)}else console.log("Could not understand the type in saveEditCreateChoice");U({})}})),We(Me.a,{isOpen:H.isVisible,handleClose:function(){return W({})},component:H.component}))})),Ye=o.a.createElement;t.default=function(){return Ye(r.c,null,Ye(Je,null))}},nhzr:function(e,t,n){n("fW1p"),e.exports=n("WEpk").Object.values},qpA4:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"}),"OpenWith");t.default=r},s8cL:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("q1tI")),r=(0,a(n("8/g6")).default)(o.default.createElement("path",{d:"M15 3l2.3 2.3-2.89 2.87 1.42 1.42L18.7 6.7 21 9V3h-6zM3 9l2.3-2.3 2.87 2.89 1.42-1.42L6.7 5.3 9 3H3v6zm6 12l-2.3-2.3 2.89-2.87-1.42-1.42L5.3 17.3 3 15v6h6zm12-6l-2.3 2.3-2.87-2.89-1.42 1.42 2.89 2.87L15 21h6v-6z"}),"ZoomOutMap");t.default=r}},[["cSug",1,2,6,8,0,3,4]]]);